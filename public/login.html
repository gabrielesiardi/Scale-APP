<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Admin Login</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="login-panel">
    <h2>Admin Login</h2>
    <input id="username" type="text" placeholder="Username" />
    <input id="password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <div class="scale-selector hidden">
    <h3>Seleziona fino a 2 bilance</h3>
    <div id="scale-options"></div>
    <button onclick="submitScales()">Salva</button>
  </div>

  <script>
    async function login() {
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('username').value,
          password: document.getElementById('password').value
        })
      });
      if (res.ok) {
        document.querySelector('.login-panel').style.display = 'none';
        document.querySelector('.scale-selector').classList.remove('hidden');
        loadScales();
      } else {
        alert("Credenziali non valide");
      }
    }

    async function loadScales() {
      const res = await fetch('/api/scales');
      const data = await res.json();
      const container = document.getElementById('scale-options');
      container.innerHTML = '';
      data.forEach(scale => {
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.value = scale.id;
        cb.name = 'scale';
        const label = document.createElement('label');
        label.textContent = scale.label;
        container.appendChild(cb);
        container.appendChild(label);
        container.appendChild(document.createElement('br'));
      });
    }

    async function submitScales() {
      const selected = Array.from(document.querySelectorAll('input[name="scale"]:checked'))
        .map(cb => cb.value);
      if (selected.length === 0 || selected.length > 2) {
        alert("Seleziona una o due bilance.");
        return;
      }
      await fetch('/api/set-scales', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ selectedScales: selected })
      });
      window.location.href = '/';
    }
  </script>
</body>
</html>
